<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dask – Parallel Python with Dask</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../lesson.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Parallel Python with Dask</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/01a-pandas_fundamentals.html"> 
<span class="menu-text">Fundamentals</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/polars-intro.html"> 
<span class="menu-text">Polars Dataframes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../notebooks/01b-TransitionToDask.html" aria-current="page"> 
<span class="menu-text">Dask</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/01d-dask_delayed.html"> 
<span class="menu-text">Scientific Computing</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#transitioning-to-dask-dataframes" id="toc-transitioning-to-dask-dataframes" class="nav-link active" data-scroll-target="#transitioning-to-dask-dataframes">Transitioning to Dask DataFrames</a></li>
  <li><a href="#contolling-laziness-and-optimising-with-dask" id="toc-contolling-laziness-and-optimising-with-dask" class="nav-link" data-scroll-target="#contolling-laziness-and-optimising-with-dask">Contolling Laziness and Optimising with Dask</a>
  <ul class="collapse">
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">Challenge</a></li>
  </ul></li>
  <li><a href="#dask-best-practice-guide" id="toc-dask-best-practice-guide" class="nav-link" data-scroll-target="#dask-best-practice-guide">Dask Best Practice Guide</a></li>
  <li><a href="#additional-info-on-dask-dataframes" id="toc-additional-info-on-dask-dataframes" class="nav-link" data-scroll-target="#additional-info-on-dask-dataframes">Additional Info on Dask DataFrames</a></li>
  <li><a href="#dask-arrays" id="toc-dask-arrays" class="nav-link" data-scroll-target="#dask-arrays">Dask Arrays</a></li>
  <li><a href="#diagnostics---profile-resource-efficiency-in-real-time" id="toc-diagnostics---profile-resource-efficiency-in-real-time" class="nav-link" data-scroll-target="#diagnostics---profile-resource-efficiency-in-real-time">Diagnostics - Profile resource efficiency in real time</a>
  <ul class="collapse">
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points">Key points</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dask</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li><a href="https://docs.dask.org/en/stable/">Dask</a></li>
<li><a href="https://docs.dask.org/en/stable/10-minutes-to-dask.html">10 minute intro</a></li>
<li><a href="https://docs.dask.org/en/stable/dataframe-api.html">API Reference</a></li>
<li><a href="https://examples.dask.org/">Examples</a></li>
</ul>
<p>Dask is a Python library for parallel and distributed computing. Dask offers an array of tools such as Dask DataFrames, Dask Bags, Dask Delayed Functions and has machine learning integrations. We will foucus with Dask DataFrames.</p>
<p><strong>Dask dataframes process data in parallel across multiple cores or machines</strong>.</p>
<p>Dask DataFrames coordinate many pandas DataFrames/Series arranged along the index.</p>
<p>Dask DataFrame is partitioned row-wise, grouping rows by index value for efficiency. These pandas objects may live on disk or on other machines.</p>
<p>Internally, a Dask DataFrame is split into many partitions, where each partition is one Pandas DataFrame. When our index is sorted and we know the values of the divisions of our partitions, then we can be clever and efficient with expensive algorithms (e.g.&nbsp;groupby’s, joins, etc…).</p>
<p><strong>Use Cases:</strong></p>
<p>Dask DataFrame is used in situations where pandas is commonly needed, usually when pandas fails due to data size or speed of computation. Common use cases are:</p>
<ul>
<li><p>Manipulating large datasets, even when those datasets don’t fit in memory</p></li>
<li><p>Accelerating long computations by using many cores</p></li>
<li><p>Distributed computing on large datasets with standard pandas operations like <code>groupby</code>, <code>join</code>, and time series computations</p></li>
</ul>
<p>Dask DataFrame may not be the best choice in the following situations:</p>
<ul>
<li><p>If your dataset fits comfortably into RAM on your laptop, then you may be better off just using pandas. There may be simpler ways to improve performance than through parallelism</p></li>
<li><p>If your dataset doesn’t fit neatly into the pandas tabular model, then you might find more use in <a href="https://docs.dask.org/en/stable/bag.html">dask.bag</a> or <a href="https://docs.dask.org/en/stable/array.html">dask.array</a></p></li>
<li><p>If you need functions that are not implemented in Dask DataFrame, then you might want to look at <a href="https://docs.dask.org/en/stable/delayed.html">dask.delayed</a> which offers more flexibility</p></li>
<li><p>If you need a proper database with all of the features that databases offer you might prefer something like <a href="https://www.postgresql.org/">Postgres</a> or <a href="https://www.sqlite.org/index.html">SQLite</a></p></li>
</ul>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import libraries and datasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.datasets</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.dataframe <span class="im">as</span> dd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">'diamonds'</span>) <span class="co"># a pandas dataframe</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'diamonds.csv'</span>) <span class="co"># can be saved to file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="transitioning-to-dask-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="transitioning-to-dask-dataframes">Transitioning to Dask DataFrames</h2>
<p>Dask mimics <strong>most</strong> but not all of the well known pandas API syntax.</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IO ---------------------------------------------------------------- </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># loading into a dask dataframe</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> dd.read_csv(<span class="st">'diamonds.csv'</span>) <span class="co">#reading multiple files with patterns dd.read_csv('d*.csv')</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> dd.from_pandas(df,npartitions <span class="op">=</span> <span class="dv">2</span>) </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># by default it has lazy execution where computation are triggered by compute() (or head) </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>ddf.compute() <span class="co"># convert dd to pd.DataFrame</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>ddf.head(<span class="dv">2</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspecting ----------------------------------------------------------------</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>ddf.npartitions <span class="co"># number of partitions</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>ddf.divisions <span class="co"># Divisions includes the minimum value of every partition’s index and the maximum value of the last partition’s index</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>ddf.partitions[<span class="dv">1</span>] <span class="co"># access a particular partition</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>ddf.partitions[<span class="dv">1</span>].index <span class="co"># which have similar pd.DataFrame attributes</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>ddf.describe().compute() <span class="co"># general stats</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>ddf.dtypes  <span class="co"># access attributes</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>ddf[[<span class="st">"carat"</span>,<span class="st">"price"</span>]] <span class="co"># subset columns</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">'new_column'</span>] <span class="op">=</span> ddf[<span class="st">'carat'</span>] <span class="op">*</span> ddf[<span class="st">'depth'</span>] <span class="co"># creating new column</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering rows ----------------------------------------------------------------</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>ddf.query(<span class="st">'price &gt; 50'</span>) <span class="co"># same as pd.DataFrame</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>ddf.loc[<span class="dv">15</span>:<span class="dv">20</span>] <span class="co"># subseing rows </span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by Aggregations ----------------------------------------------------------------</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># By default, groupby methods return an object with only 1 partition. </span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># This is to optimize performance, and assumes the groupby reduction returns an object that is small enough to fit into memory. </span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># If your returned object is larger than this, you can increase the number of output partitions using the split_out argument.</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>ddf.groupby(<span class="st">'cut'</span>).price.mean() <span class="co">#npartitions=1</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#ddf.groupby('cut').mean(split_out=2) #npartitions=2</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># dask aggregate has more features than pandas agg equivalent, supports reductions on the same group.</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>ddf_aggs <span class="op">=</span> (ddf.groupby(<span class="st">'cut'</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    .aggregate({<span class="st">"price"</span>:<span class="st">"mean"</span>,<span class="st">"carat"</span>:<span class="st">"sum"</span>})).compute()</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>ddf_aggs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">carat</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">cut</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ideal</td>
<td>3457.541970</td>
<td>15146.84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Premium</td>
<td>4584.257704</td>
<td>12300.95</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Good</td>
<td>3928.864452</td>
<td>4166.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Very Good</td>
<td>3981.759891</td>
<td>9742.70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fair</td>
<td>4358.757764</td>
<td>1684.28</td>
</tr>
</tbody>
</table>

</div>
</section>
<section id="contolling-laziness-and-optimising-with-dask" class="level2">
<h2 class="anchored" data-anchor-id="contolling-laziness-and-optimising-with-dask">Contolling Laziness and Optimising with Dask</h2>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#controlling when execution occurs is key to performance</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>lazy_manipulations <span class="op">=</span> (ddf.query(<span class="st">'price &gt; 50'</span>).</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    groupby(<span class="st">'clarity'</span>).</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    price.mean())</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>lazy_manipulations.compute() <span class="co"># trigger computation to pd.DataFrame</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Can persist data into RAM if possible making future operations on it faster</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>ddf_aggs <span class="op">=</span> ddf_aggs.repartition(npartitions <span class="op">=</span> <span class="dv">1</span>).persist()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">carat_original</th>
<th data-quarto-table-cell-role="th">cut</th>
<th data-quarto-table-cell-role="th">color</th>
<th data-quarto-table-cell-role="th">clarity</th>
<th data-quarto-table-cell-role="th">depth</th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">price_original</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">z</th>
<th data-quarto-table-cell-role="th">price_aggregated</th>
<th data-quarto-table-cell-role="th">carat_aggregated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.23</td>
<td>Ideal</td>
<td>E</td>
<td>SI2</td>
<td>61.5</td>
<td>55.0</td>
<td>326</td>
<td>3.95</td>
<td>3.98</td>
<td>2.43</td>
<td>3457.54197</td>
<td>15146.84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0.23</td>
<td>Ideal</td>
<td>J</td>
<td>VS1</td>
<td>62.8</td>
<td>56.0</td>
<td>340</td>
<td>3.93</td>
<td>3.90</td>
<td>2.46</td>
<td>3457.54197</td>
<td>15146.84</td>
</tr>
</tbody>
</table>

</div>
<p>Note that not all apis from pandas are available in Dask. For example, <code>ddf.filter(['carat','price'])</code> is not available. For more details and a list of available options, see <a href="https://docs.dask.org/en/stable/dataframe-api.html">here</a>.</p>
<section id="challenge" class="level3 challenge">
<h3 class="anchored" data-anchor-id="challenge">Challenge</h3>
<ol type="a">
<li><p>What is the price per carat over the entire dataset?</p></li>
<li><p>Create a column called price_to_carat that calculates this for each row</p></li>
<li><p>Create a column called expensive that flags whether price is greater than price_to_carat</p></li>
<li><p>How many expensive diamonds are there</p></li>
</ol>
<details>
<summary>
Solution
</summary>
<ul>
<li>Average price to carat $4928</li>
<li>15003 expensive diamonds compared to whole dataset</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>price_per_carat <span class="op">=</span> (ddf.price.<span class="bu">sum</span>() <span class="op">/</span> ddf.carat.<span class="bu">sum</span>()).compute()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> ddf.assign(price_to_carat <span class="op">=</span> ddf.price <span class="op">/</span> ddf.carat)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greater_than_avg(price):</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> price <span class="op">&gt;</span> price_per_carat:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> ddf.assign(expensive <span class="op">=</span> ddf.price.<span class="bu">apply</span>(greater_than_avg))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>ddf.sort_values(<span class="st">'expensive'</span>,ascending<span class="op">=</span> <span class="va">False</span>).compute()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>number_expensive <span class="op">=</span> ddf.expensive.<span class="bu">sum</span>().compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
</section>
<section id="dask-best-practice-guide" class="level2">
<h2 class="anchored" data-anchor-id="dask-best-practice-guide">Dask Best Practice Guide</h2>
<ol type="1">
<li><strong>Use <code>set_index()</code> sparingly</strong> to speed up data naturally sorted on a single index
<ul>
<li>Use <code>ddf.set_index('column')</code></li>
</ul></li>
<li><strong>Persist intelligently</strong></li>
</ol>
<ul>
<li>If you have the available RAM for your dataset then you can persist data in memory. On distributed systems, it is a way of telling the cluster that it should start executing the computations that you have defined so far, and that it should try to keep those results in memory.
<ul>
<li><code>df = df.persist()</code></li>
</ul></li>
</ul>
<ol start="3" type="1">
<li><strong>Repartition to reduce overhead</strong>
<ul>
<li>As you reduce or increase the size of your pandas DataFrames by filtering or joining, it may be wise to reconsider how many partitions you need. Adjust partitions accordingly using repartition.</li>
<li><code>df = df.repartition(npartitions=df.npartitions // 100)</code></li>
</ul></li>
<li><strong>Consider storing large data in <a href="https://parquet.apache.org/">Apache Parquet</a> Format</strong> (binary column based format)</li>
</ol>
</section>
<section id="additional-info-on-dask-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="additional-info-on-dask-dataframes">Additional Info on Dask DataFrames</h2>
<p>To learn more on how to use dask dataframes, feel free to go through <a href="https://examples.dask.org/dataframes/04-reading-messy-data-into-dataframes.html">Reading Messy Data Binder</a> at your own pace.This example demostrates both dask and using delayed functions. Otherwise <a href="https://docs.dask.org/en/stable/dataframe.html#">here</a> is more info including best practices and the API, and other <a href="https://tutorial.dask.org/">tutorials</a> on dask is also available.</p>
</section>
<section id="dask-arrays" class="level2">
<h2 class="anchored" data-anchor-id="dask-arrays">Dask Arrays</h2>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> da.random.random((<span class="dv">10000</span>, <span class="dv">10000</span>), chunks<span class="op">=</span>(<span class="dv">1000</span>, <span class="dv">1000</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>762.94 MiB</td>
<td>7.63 MiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(10000, 10000)</td>
<td>(1000, 1000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dask graph</td>
<td colspan="2">100 chunks in 1 graph layer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Data type</td>
<td colspan="2">float64 numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="170" height="170" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines -->
<line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2"></line>
<line x1="0" y1="12" x2="120" y2="12"></line>
<line x1="0" y1="24" x2="120" y2="24"></line>
<line x1="0" y1="36" x2="120" y2="36"></line>
<line x1="0" y1="48" x2="120" y2="48"></line>
<line x1="0" y1="60" x2="120" y2="60"></line>
<line x1="0" y1="72" x2="120" y2="72"></line>
<line x1="0" y1="84" x2="120" y2="84"></line>
<line x1="0" y1="96" x2="120" y2="96"></line>
<line x1="0" y1="108" x2="120" y2="108"></line>
<line x1="0" y1="120" x2="120" y2="120" style="stroke-width:2"></line>
<!-- Vertical lines -->
<line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2"></line>
<line x1="12" y1="0" x2="12" y2="120"></line>
<line x1="24" y1="0" x2="24" y2="120"></line>
<line x1="36" y1="0" x2="36" y2="120"></line>
<line x1="48" y1="0" x2="48" y2="120"></line>
<line x1="60" y1="0" x2="60" y2="120"></line>
<line x1="72" y1="0" x2="72" y2="120"></line>
<line x1="84" y1="0" x2="84" y2="120"></line>
<line x1="96" y1="0" x2="96" y2="120"></line>
<line x1="108" y1="0" x2="108" y2="120"></line>
<line x1="120" y1="0" x2="120" y2="120" style="stroke-width:2"></line>
<!-- Colored Rectangle -->
<polygon points="0.0,0.0 120.0,0.0 120.0,120.0 0.0,120.0" style="fill:#ECB172A0;stroke-width:0"></polygon>
<!-- Text -->
<text x="60.000000" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle">10000</text>
<text x="140.000000" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,60.000000)">10000</text>
</svg></td>
</tr>
</tbody>
</table>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numpy syntax as usual</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x <span class="op">+</span> x.T</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> y[::<span class="dv">2</span>, <span class="dv">5000</span>:].mean(axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># axis 0 is index, axis 1 is columns</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>z</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Trigger compute and investigate Client</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td><table class="caption-top table" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th></th>
<th data-quarto-table-cell-role="th">Array</th>
<th data-quarto-table-cell-role="th">Chunk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bytes</td>
<td>39.06 kiB</td>
<td>3.91 kiB</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Shape</td>
<td>(5000,)</td>
<td>(500,)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Count</td>
<td>7 Graph Layers</td>
<td>10 Chunks</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Type</td>
<td>float64</td>
<td>numpy.ndarray</td>
</tr>
</tbody>
</table></td>
<td><svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1">
<!-- Horizontal lines -->
<line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2"></line>
<line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2"></line>
<!-- Vertical lines -->
<line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2"></line>
<line x1="12" y1="0" x2="12" y2="25"></line>
<line x1="24" y1="0" x2="24" y2="25"></line>
<line x1="36" y1="0" x2="36" y2="25"></line>
<line x1="48" y1="0" x2="48" y2="25"></line>
<line x1="60" y1="0" x2="60" y2="25"></line>
<line x1="72" y1="0" x2="72" y2="25"></line>
<line x1="84" y1="0" x2="84" y2="25"></line>
<line x1="96" y1="0" x2="96" y2="25"></line>
<line x1="108" y1="0" x2="108" y2="25"></line>
<line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2"></line>
<!-- Colored Rectangle -->
<polygon points="0.0,0.0 120.0,0.0 120.0,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"></polygon>
<!-- Text -->
<text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle">5000</text>
<text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg></td>
</tr>
</tbody>
</table>
</section>
<section id="diagnostics---profile-resource-efficiency-in-real-time" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics---profile-resource-efficiency-in-real-time">Diagnostics - Profile resource efficiency in real time</h2>
<p>The Dask Dashboard enables resource monitoring across RAM, CPU, workers, threads and tasks (functions), in real time as your code is running. It opens a user friendly dashboard allowing you to inspect what processes are running and what work (or bottlenecks) exist across your cores.</p>
<p><a href="https://docs.dask.org/en/stable/dashboard.html">See here</a> for documentation and videos.</p>
<section id="a-few-key-definitions" class="level4">
<h4 class="anchored">A few key definitions:</h4>
<ul>
<li><p><strong>Bytes Stored and Bytes per Worker</strong>: Cluster memory and Memory per worker.</p></li>
<li><p><strong>Task Processing/CPU Utilization/Occupancy</strong>: Tasks being processed by each worker/ CPU Utilization per worker/ Expected runtime for all tasks currently on a worker.</p></li>
<li><p><strong>Progress</strong>: Progress of a set of tasks.</p></li>
</ul>
<p>There are three different colors of workers in a task graph:</p>
<ul>
<li><p><strong>Blue</strong>: Processing tasks.</p></li>
<li><p><strong>Green</strong>: Saturated: It has enough work to stay busy.</p></li>
<li><p><strong>Red</strong>: Idle: Does not have enough work to stay busy.</p></li>
<li><p><strong>Task Stream</strong>: Individual task across threads.</p>
<ul>
<li>White colour represents deadtime.</li>
</ul></li>
</ul>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To load diagnostic in web browser on local. Wont work on CoLab.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>client <span class="co">#client.shutdown after use</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;" class="anchored" data-anchor-id="a-few-key-definitions">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-282909c2-4e0d-11ef-8d95-d687d7367288</p>
        
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
<td style="text-align: left;"><strong>Cluster type:</strong> distributed.LocalCluster</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


        

        
            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;" class="anchored">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;" class="anchored">LocalCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">2c397460</p>
        
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Workers:</strong> 5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total threads:</strong> 10</td>
<td style="text-align: left;"><strong>Total memory:</strong> 32.00 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Status:</strong> running</td>
<td style="text-align: left;"><strong>Using processes:</strong> True</td>
</tr>
</tbody>
</table>


        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;" class="anchored">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;" class="anchored">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-07b1460e-b35e-4c3c-afc5-5a9b007d4875</p>
            
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50573</td>
<td style="text-align: left;"><strong>Workers:</strong> 5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:8787/status" target="_blank">http://127.0.0.1:8787/status</a></td>
<td style="text-align: left;"><strong>Total threads:</strong> 10</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Started:</strong> Just now</td>
<td style="text-align: left;"><strong>Total memory:</strong> 32.00 GiB</td>
</tr>
</tbody>
</table>

        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;" class="anchored">Workers</h3>
        </summary>

        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 0</h4>
                </summary>
                
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50592</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:50597/status" target="_blank">http://127.0.0.1:50597/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 6.40 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:50576</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /var/folders/j2/6znnc26n7r9gk1qjgh7wy6bh0000gn/T/dask-scratch-space/worker-jt_xmqss</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 1</h4>
                </summary>
                
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50593</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:50598/status" target="_blank">http://127.0.0.1:50598/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 6.40 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:50577</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /var/folders/j2/6znnc26n7r9gk1qjgh7wy6bh0000gn/T/dask-scratch-space/worker-1c5y5lww</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 2</h4>
                </summary>
                
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50594</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:50599/status" target="_blank">http://127.0.0.1:50599/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 6.40 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:50578</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /var/folders/j2/6znnc26n7r9gk1qjgh7wy6bh0000gn/T/dask-scratch-space/worker-3b1scof8</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 3</h4>
                </summary>
                
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50595</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:50604/status" target="_blank">http://127.0.0.1:50604/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 6.40 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:50579</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /var/folders/j2/6znnc26n7r9gk1qjgh7wy6bh0000gn/T/dask-scratch-space/worker-rkqgplj_</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="width: 24px; height: 24px; background-color: #DBF5FF; border: 3px solid #4CC9FF; border-radius: 5px; position: absolute;"> </div>
            <div style="margin-left: 48px;">
            <details>
                <summary>
                    <h4 style="margin-bottom: 0px; display: inline;" class="anchored">Worker: 4</h4>
                </summary>
                
<table class="caption-top table" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Comm:</strong> tcp://127.0.0.1:50596</td>
<td style="text-align: left;"><strong>Total threads:</strong> 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Dashboard:</strong> <a href="http://127.0.0.1:50603/status" target="_blank">http://127.0.0.1:50603/status</a></td>
<td style="text-align: left;"><strong>Memory:</strong> 6.40 GiB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Nanny:</strong> tcp://127.0.0.1:50580</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td colspan="2" style="text-align: left;"><strong>Local directory:</strong> /var/folders/j2/6znnc26n7r9gk1qjgh7wy6bh0000gn/T/dask-scratch-space/worker-n26yax3w</td>
</tr>
</tbody>
</table>

            </details>
            </div>
        </div>
        

    </details>
</div>

        </details>
    </div>
</div>
            </details>
        

    </div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of efficient resource utilisation</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> da.random.random(size <span class="op">=</span> (<span class="dv">10_000</span>,<span class="dv">10_000</span>,<span class="dv">10</span>), chunks<span class="op">=</span> (<span class="dv">1000</span>,<span class="dv">1000</span>,<span class="dv">5</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> da.random.random(size <span class="op">=</span> (<span class="dv">10_000</span>,<span class="dv">10_000</span>,<span class="dv">10</span>), chunks<span class="op">=</span> (<span class="dv">1000</span>,<span class="dv">1000</span>,<span class="dv">5</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> (da.arcsin(x) <span class="op">+</span> da.arcsin(y)).<span class="bu">sum</span>(axis <span class="op">=</span> (<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>z.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>array([114088.23038208, 114412.76898299, 114062.70087907, ...,
       114507.50869038, 114166.89260871, 113983.68356763])</code></pre>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inefficient resource utilisation - dask introduces too much overhead for simple sizes np handles well</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> da.random.random(size <span class="op">=</span> (<span class="dv">10_000_000</span>),chunks <span class="op">=</span> (<span class="dv">1000</span>,))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>x.<span class="bu">sum</span>().compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>/Users/kris/miniconda3/envs/parallel/lib/python3.9/site-packages/distributed/client.py:3357: UserWarning: Sending large graph of size 25.26 MiB.
This may cause some slowdown.
Consider scattering data ahead of time and using futures.
  warnings.warn(</code></pre>
<pre><code>5000296.402465192</code></pre>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>client.shutdown</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;bound method Client.shutdown of &lt;Client: 'tcp://127.0.0.1:50573' processes=5 threads=10, memory=32.00 GiB&gt;&gt;</code></pre>
</section>
<section id="key-points" class="level3 keypoints">
<h3 class="anchored" data-anchor-id="key-points">Key points</h3>
<ul>
<li><p>The similarity-by-design of the Dask API with pandas makes the transition easy compared to alternatives - although not all functions are replicated.</p></li>
<li><p>Scaling up to distributed systems, or down to simply running on your laptop, makes code easily transferable between different resources.</p></li>
<li><p>Dask enables parallelism without low level alterations in code.</p></li>
</ul>
</section>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Sydney-Informatics-Hub\.github\.io\/ParallelPython\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>